<htm>
 <head>
  <title>markdown editor javascript version</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="./../libs/milligram/dist/milligram.min.css">
  <link rel="stylesheet" href="./../libs/sparksuite-simplemde/dist/simplemde.min.css">
  <script src="./../libs/sparksuite-simplemde/dist/simplemde.min.js"></script>
 </head>
  <body>
  <h1>Markdown Editor - Javascript version</h1>
  <label>Read File:</label>
  <div class="row">
    <div class="column column-10">
            <button name="choose" id="choose" onclick="readingFile();" type="button">Choose</button>
        </div>
    <div class="column column-20">
        <input type="text" name="readfile" id="readfile" placeholder="Choose a file to read" />
    </div>
    <div class="column">
            <button name="read" id="read" onclick="loadSelectedFile();" type="button">Read</button>
    </div>
  </div>
  <div>
    <textarea id="editor" name="name"></textarea>
    <label>Save file:</label>
    <div class="row">
        <div class="column column-50">
            <input id="filename" type="text" placeholder="input file name" >
        </div>
        <div class="column column-10">
            <a class="button" id="download" href="#" download="text.md" onclick="handleDownload()">Save</a>
        </div>
    </div>
   </div>
 <script>
 var simplemde = new SimpleMDE({ 
    //https://github.com/sparksuite/simplemde-markdown-editor/blob/master/src/js/simplemde.js
    //Line 1069 : var var toolbarBuiltInButtons = {...}
    // toolbar: [
    //     {
	// 		name: "custom",
	// 		action: function customFunction(editor){
	// 			// Add your own code
    //             alert("custome button")
	// 		},
	// 		className: "fa fa-star",
	// 		title: "Custom Button",
	// 	},
    // ],

     element: document.getElementById("editor") });

 var chooseBtn = document.getElementById("choose");

 var inputFile = document.createElement("input");
     inputFile.setAttribute("type","file");
     inputFile.setAttribute("name","selectedfile");
     inputFile.setAttribute("id","selectedfile");
     inputFile.setAttribute("onchange","setName()");
     inputFile.setAttribute("style","visibility:hidden; height:0");
    
 function readingFile(){
    inputFile.click();
 }

 function setName(){
    var readFileName = document.getElementById("readfile");
    var fileFullPath = inputFile.value;
    if (fileFullPath) {
        var startIndex = (fileFullPath.indexOf('\\') >= 0 ? fileFullPath.lastIndexOf('\\') : fileFullPath.lastIndexOf('/'));
        var filename = fileFullPath.substring(startIndex);
        if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
            filename = filename.substring(1);
        }
        readFileName.setAttribute("value",filename);
    }
 }

 function loadSelectedFile(){
    const selectedFile = inputFile.files[0];
    if (selectedFile){
        const reader = new FileReader();
        reader.onload = function(){
            var base64result = reader.result;
            var startIndex = base64result.lastIndexOf(',');
            var base64Data = base64result.substring(startIndex).replace(',','');
            var content = convertBase64toData(base64Data)
            simplemde.value(content);
        };
        reader.readAsDataURL(selectedFile);
    } else {
        alert("Please select a file");
    }    
 }

 function convertBase64toData(base64Value){
     var textContent = "";
     try{
        textContent = decodeURI(escape(atob(base64Value)));
     } catch (e){
        alert("Could not get file content! Please choose a file.");
     }
    return textContent;
 }

 function handleDownload() {
     var filename = document.getElementById("filename").value + ".md";
     if (filename == ".md"){
         alert("Please enter save file name");
         return 0;
     }
     document.getElementById("download").setAttribute("download", filename);
     
     var content =simplemde.value();
     var blob = new Blob([ content ], { "type" : "text/plain" });

     if (window.navigator.msSaveBlob) { 
         window.navigator.msSaveBlob(blob, filename); 
         window.navigator.msSaveOrOpenBlob(blob, filename); 
     } else {
         document.getElementById("download").href = window.URL.createObjectURL(blob);
     }
 }
////Fulloptions
//  var simplemde = new SimpleMDE({
//     autofocus: true,
//     autosave: {
//         enabled: true,
//         uniqueId: "MyUniqueID",
//         delay: 1000,
//     },
//     blockStyles: {
//         bold: "__",
//         italic: "_"
//     },
//     element: document.getElementById("editor"),
//     forceSync: true,
//     hideIcons: ["guide", "heading"],
//     indentWithTabs: false,
//     initialValue: "Hello world!",
//     insertTexts: {
//         horizontalRule: ["", "\n\n-----\n\n"],
//         image: ["![](http://", ")"],
//         link: ["[", "](http://)"],
//         table: ["", "\n\n| Column 1 | Column 2 | Column 3 |\n| -------- | -------- | -------- |\n| Text     | Text      | Text     |\n\n"],
//     },
//     lineWrapping: false,
//     parsingConfig: {
//         allowAtxHeaderWithoutSpace: true,
//         strikethrough: false,
//         underscoresBreakWords: true,
//     },
//     placeholder: "Type here...",
//     previewRender: function(plainText) {
//         return customMarkdownParser(plainText); // Returns HTML from a custom parser
//     },
//     previewRender: function(plainText, preview) { // Async method
//         setTimeout(function(){
//             preview.innerHTML = customMarkdownParser(plainText);
//         }, 250);

//         return "Loading...";
//     },
//     promptURLs: true,
//     renderingConfig: {
//         singleLineBreaks: false,
//         codeSyntaxHighlighting: true,
//     },
//     shortcuts: {
//         drawTable: "Cmd-Alt-T"
//     },
//     showIcons: ["code", "table"],
//     spellChecker: false,
//     status: false,
//     status: ["autosave", "lines", "words", "cursor"], // Optional usage
//     status: ["autosave", "lines", "words", "cursor", {
//         className: "keystrokes",
//         defaultValue: function(el) {
//             this.keystrokes = 0;
//             el.innerHTML = "0 Keystrokes";
//         },
//         onUpdate: function(el) {
//             el.innerHTML = ++this.keystrokes + " Keystrokes";
//         }
//     }], // Another optional usage, with a custom status bar item that counts keystrokes
//     styleSelectedText: false,
//     tabSize: 4,
//     toolbar: false,
//     toolbarTips: false,
// });
 ////Fulloptions
  </script>
 </body>
</htm>